# geth 共识节点高可用测试
## 测试目的
了解共识节点因为不可控因素导致的从集群中掉线后的集群工作情况

- 测试方法

	k8s关停测试节点 geth pod
	 
## 三共识节点
- 单节点下线
	- 测试结果

		出块正常，效率不变
	- 启动

		启动后恢复，但修复节点需要同步块，需要占用集群额外的资源同步新增节点块，这个时候，
		
		- 同步的块间隔越小越好
		- 节点越多越好(p2p同步)
- 双节点下线
	- 测试结果

		无法出块，因为违反了 poa 共识算法，需要启动节点
	- 启动同上

## 五共识节点
- 从三共识升级成五共识节点
	- 直接设置新节点为共识节点
		- 问题

			会造成大量的空块，检查发现因为同步占用了大部分的带宽，并且设置的新共识节点还不同步。
		- 解决

			优化方案，共识节点添加需要先做成普通节点同步数据完毕后，再升级成共识节点
		- 测试结果

			新增普通节点，同步数据后再升级共识节点，这样减少印块没有同步完成导致新共识节点出空块的问题。
- 5 共识节点压力测试
	- 问题

		5共识节点压力测试发现出空块的情况比较多，查询后发现是因为业务之间的同步带宽超过了设置带宽，导致5个共识服务器不能很快完成共识。
	- 解决
	
		增加带宽后解决
- 5 共识节点增加 2 普通节点测试
	- 问题

		2个新的普通节点同步区块会将所有共识节点的带宽占满，导致交易 tps 会受到影响，并且没有参数限制
	- 解决方法
		
		分立同步专用普通节点，用来对新增节点，用来对新增节点进行数据同步，而新增节点不能直接链接共识节点。避免影响交易tps 	 		 	
		 		
		
			  

		

	 

